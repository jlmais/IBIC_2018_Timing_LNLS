\documentclass[a4paper,
               %boxit,        % check whether paper is inside correct margins
               %titlepage,    % separate title page
               %refpage       % separate references
               biblatex,      % biblatex is used
               %keeplastbox,  % flushend option: not to un-indent last line in References
               %nospread,     % flushend option: do not fill with whitespace to balance columns
               %hyphens,      % allow \url to hyphenate at "-" (hyphens)
               %xetex,        % use XeLaTeX to process the file
               %luatex,       % use LuaLaTeX to process the file
               ]{jacow}
%
% ONLY FOR \footnote in table/tabular
%
\usepackage{pdfpages,multirow,ragged2e} %
%
% CHANGE SEQUENCE OF GRAPHICS EXTENSION TO BE EMBEDDED
% ----------------------------------------------------
% test for XeTeX where the sequence is by default eps-> pdf, jpg, png, pdf, ...
%    and the JACoW template provides JACpic2v3.eps and JACpic2v3.jpg which
%    might generates errors, therefore PNG and JPG first
%
\makeatletter%
	\ifboolexpr{bool{xetex}}
	 {\renewcommand{\Gin@extensions}{.pdf,%
	                    .png,.jpg,.bmp,.pict,.tif,.psd,.mac,.sga,.tga,.gif,%
	                    .eps,.ps,%
	                    }}{}
\makeatother

% CHECK FOR XeTeX/LuaTeX BEFORE DEFINING AN INPUT ENCODING
% --------------------------------------------------------
%   utf8  is default for XeTeX/LuaTeX
%   utf8  in LaTeX only realises a small portion of codes
%
\ifboolexpr{bool{xetex} or bool{luatex}} % test for XeTeX/LuaTeX
 {}                                      % input encoding is utf8 by default
 {\usepackage[utf8]{inputenc}}           % switch to utf8

\usepackage[USenglish]{babel}

\addbibresource{citations.bib}

% Don't justify URLs in the references
\renewcommand*{\bibfont}{\raggedright}

%%
%%   Lengths for the spaces in the title
%%   \setlength\titleblockstartskip{..}  %before title, default 3pt
%%   \setlength\titleblockmiddleskip{..} %between title + author, default 1em
%%   \setlength\titleblockendskip{..}    %afterauthor, default 1em

\begin{document}

\title{A MicroTCA.4  Timing Receiver for the Sirius Timing System}

\author{J.L.N. Brito\thanks{joao.brito@lnls.br}, S.R. Marques, D.O. Tavares, L.M. Russo, G.B.M. Bruno, LNLS, Campinas, Brazil}
	
\maketitle

%
\begin{abstract}
   The AMC FMC carrier (AFC) is a MicroTCA.4 AMC board which has a very flexible clock circuit that enables any clock source to be connected to any clock input, including telecom clock, FMC clocks, programmable VCXO oscillator and FPGA. This paper presents the use of the AFC board as an event receiver connected to the Sirius timing system to provide low jitter synchronized clocks and triggers for Sirius BPM electronics and other devices.
\end{abstract}


\section{introduction}
Sirius is a 4th  generation  synchrotron light source  based  on  a 5BA magnetic lattice under construction in Brazil by LNLS~\cite{sirius_ipac16}. The machine, scheduled for commissioning in the end of 2018~\cite{rodrigues2016sirius}, consists of a 150 MeV Linac, a 150 MeV to 3 GeV booster synchrotron and a 3 GeV, 518 meters circumference, storage ring with 20 straight sections, designed to achieve a beam emittance of \SI{0.25}{nm$\cdot$rad}. Booster and storage RF frequency is \SI{499.658}{MHz} and Linac will inject in single or multi-bunch mode at \SI{2}{Hz}.

Sirius timing system~\cite{timing_icalepcs15} is a star topology optical fiber network where an event generator broadcasts event frames to event receivers. From a decoded event frame an event receiver can output low jitter signals synchronized to the RF frequency for the beam injection process as well as reference clocks and triggers for diverse subsystems such as electron BPMs. The system is composed of Ethernet-configured standalone modules developed by SINAP through a collaboration with LNLS and controlled remotely by an EPICS soft IOC designed by LNLS~\cite{sinap-timing-epics-ioc}.

The Sirius BPM electronics is composed by an analog standalone module, an ADC and a DSP board ... MicroTCA.4 platform was adopted ... The AMC FMC carrier (AFC)~\cite{afc-git} is a MicroTCA.4 AMC board partially based on Simple PCIe FMC carrier (SPEC)~\cite{spec} design. 
The AFC board was designed to be an open-source platform for Sirius BPM and orbit feedback systems~\cite{ebpm_icalepcs13}.

Thanks to the flexible clock circuits and triggers distribution available in AFC board and MicroTCA.4 platform we decide to develop and timing receiver board based on the same hardware platform... 

\section{hardware}
Short review about hardware focusing on timing application.

\subsection{AMC FMC Carrier (AFC)}

Merge description below with technical features described in AFC ohwr focusing on timing issues

The  DBE  FPGA  board  was  specified  by  LNLS  and  designed  by  WUT  as  a  double-width  AMC  card  fully  compliant  to  the  MicroTCA.4  standard,  featuring  large  SDRAM   memory   (512   MB   or   2   GB)   with   32-bit   interface,    2    fully    populated    high-pin    count    FMC    mezzanine slots, option for 8 multigigabit links routed to the    MicroTCA    Rear    Transition    Module    (
uRTM) connector, 8 MicroTCA.4 M-LVDS triggers, connectivity to  PCIe  at  Fat  Pipe  1  (x4  link),  redundant  1  Gb  Ethernet  ports,  full  hardware  support  for  the  White  Rabbit  timing  system, flexible clocking multiplexing allowing routing of 
MicroTCA.4  low-jitter  clocks  to  any  of  the  FMC  slots  and provision for standalone operation. The FPGA device in  use  is  Xilinx  Artix-7  200T  FFG1156,  which  provides  large I/O pin count at low price. 

It has 8 bidirectional trigger lines in the AMC connector... Flexible clock circuits... HPC FMC connectors with n differential clocks and n triggers... Artix-7 FPGA ...

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.8\columnwidth]{AFC_POFs_resized}
   \caption{AFC mounted with 2 FMC-POF.}
   \label{fig:afc_pofs}
\end{figure}

\subsection{FMC-POF}
The FMC-POF \cite{fmc-pof-git} was designed to provide 5 POF outputs to triggers external devices near to the BPM Crate such as current power supplies.

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.5\columnwidth]{FMC_POF_resized}
   \caption{FMC-POF.}
   \label{fig:fmc_pof}
\end{figure}

\subsection{RTM-SFP}
The RTM-SFP \cite{rtm-sfp-git} is a Rear Transition Module board MicroTCA.4 standard. Its main components are 8 SFP connectors to provide optical fiber interface with timing system and a Si570 programmable oscillator to output a reference clock to GTP transceivers. 

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.8\columnwidth]{RTM_SFP_resized}
   \caption{RTM with 8 SFP.}
   \label{fig:rtm_sfp}
\end{figure}

\section{FPFA Gateware}

This section describes the main aspects of the FPGA gateware to implement an event receiver and a frequency and phase locked loop to output a low jitter synchronized clock which is the reference to the ADCs of the BPM electronics.

\subsection{Event Receiver}

Describes configurable parameters implemented to the event receiver like pulse width, delay, polarity and so on. Take the EVE and EVR description in the last paper as an example.

\subsection{Low Jitter Synchronized Clock}
The main purpose of this project is providing reference clock to the ADCs of the BPM electronics. The defined frequency to be the reference was $\frac{5}{36}RF$
The PLL FPGA block generates from event clock the reference clock and  
\[f_{dmtd} = f_{ref}\frac{N}{N+1}\]

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.8\columnwidth]{AFCRefClockLoop}
   \caption{Layout of frequency and phase loop.}
   \label{fig:AFCRefClockLoop}
\end{figure}

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.8\columnwidth]{AFCFPGADMTD}
   \caption{FPGA frequency and phase controller.}
   \label{fig:AFCFPGADMTD}
\end{figure}

\begin{figure}[!htb]
   \centering
   \includegraphics*[width=0.8\columnwidth]{AFC_TIMING_SI571}
   \caption{Phase noise.}
   \label{fig:AFCPhaseNoise}
\end{figure}

\section{Software Interface}
Describe the software interface supported HALCS and EPICS IOC.

\section{CONCLUSION}

Analyse tests?

\printbibliography
\newpage

\end{document}
